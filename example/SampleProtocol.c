/**
  *@file SampleProtocol.cpp
  *@brief generated protocol source code
  *@author make_protocol.py
  *@date 03/19/19
  */

/***********************************************************
        THIS FILE IS AUTOGENERATED. DO NOT MODIFY
***********************************************************/

#include "SampleProtocol.h"

#include "Utilities/PolyPacket/poly_parser.h"


//Declare extern packet descriptors
poly_packet_desc_t* ACK_P_DESC;
poly_packet_desc_t* SETDATA_P_DESC;
poly_packet_desc_t* GETDATA_P_DESC;
poly_packet_desc_t* RESPDATA_P_DESC;
poly_packet_desc_t* BLOCKREQ_P_DESC;
poly_packet_desc_t* BLOCKRESP_P_DESC;


//Declare extern field descriptors
poly_field_desc_t* SRC_F_DESC;
poly_field_desc_t* DST_F_DESC;
poly_field_desc_t* CMD_F_DESC;
poly_field_desc_t* SENSORA_F_DESC;
poly_field_desc_t* SENSORB_F_DESC;
poly_field_desc_t* SENSORNAME_F_DESC;
poly_field_desc_t* BLOCKOFFSET_F_DESC;
poly_field_desc_t* BLOCKSIZE_F_DESC;
poly_field_desc_t* BLOCKDATA_F_DESC;


poly_parser_t* SP_PARSER;

void sp_protocol_init()
{
  SP_PARSER = new_poly_parser(6,ifaces);

//Build Packet descriptors
  ACK_P_DESC = new_poly_packet_desc("ack", 0 );
  SETDATA_P_DESC = new_poly_packet_desc("SetData", 5 );
  GETDATA_P_DESC = new_poly_packet_desc("GetData", 5 );
  RESPDATA_P_DESC = new_poly_packet_desc("RespData", 5 );
  BLOCKREQ_P_DESC = new_poly_packet_desc("blockReq", 4 );
  BLOCKRESP_P_DESC = new_poly_packet_desc("blockResp", 5 );


  //Build Field descriptors
  SRC_F_DESC = new_poly_field_desc("src", TYPE_UINT16 , 1 , FORMAT_HEX );
  DST_F_DESC = new_poly_field_desc("dst", TYPE_UINT16 , 1 , FORMAT_HEX );
  CMD_F_DESC = new_poly_field_desc("cmd", TYPE_UINT8 , 1 , FORMAT_HEX );
  SENSORA_F_DESC = new_poly_field_desc("sensorA", TYPE_INT16 , 1 , FORMAT_DEC );
  SENSORB_F_DESC = new_poly_field_desc("sensorB", TYPE_INT , 1 , FORMAT_DEC );
  SENSORNAME_F_DESC = new_poly_field_desc("sensorName", TYPE_STRING , 32 , FORMAT_ASCII );
  BLOCKOFFSET_F_DESC = new_poly_field_desc("blockOffset", TYPE_UINT32 , 1 , FORMAT_HEX );
  BLOCKSIZE_F_DESC = new_poly_field_desc("blockSize", TYPE_UINT32 , 1 , FORMAT_DEC );
  BLOCKDATA_F_DESC = new_poly_field_desc("blockData", TYPE_UINT8 , 64 , FORMAT_NONE );


  //Setting fields Descriptors for SetdataPacket
  poly_packet_desc_add_field(SETDATA_P_DESC , SRC_F_DESC , true );
  poly_packet_desc_add_field(SETDATA_P_DESC , DST_F_DESC , true );
  poly_packet_desc_add_field(SETDATA_P_DESC , SENSORA_F_DESC , false );
  poly_packet_desc_add_field(SETDATA_P_DESC , SENSORB_F_DESC , false );
  poly_packet_desc_add_field(SETDATA_P_DESC , SENSORNAME_F_DESC , false );


  //Setting fields Descriptors for GetdataPacket
  poly_packet_desc_add_field(GETDATA_P_DESC , SRC_F_DESC , true );
  poly_packet_desc_add_field(GETDATA_P_DESC , DST_F_DESC , true );
  poly_packet_desc_add_field(GETDATA_P_DESC , SENSORA_F_DESC , false );
  poly_packet_desc_add_field(GETDATA_P_DESC , SENSORB_F_DESC , false );
  poly_packet_desc_add_field(GETDATA_P_DESC , SENSORNAME_F_DESC , false );


  //Setting fields Descriptors for RespdataPacket
  poly_packet_desc_add_field(RESPDATA_P_DESC , SRC_F_DESC , true );
  poly_packet_desc_add_field(RESPDATA_P_DESC , DST_F_DESC , true );
  poly_packet_desc_add_field(RESPDATA_P_DESC , SENSORA_F_DESC , false );
  poly_packet_desc_add_field(RESPDATA_P_DESC , SENSORB_F_DESC , false );
  poly_packet_desc_add_field(RESPDATA_P_DESC , SENSORNAME_F_DESC , false );


  //Setting fields Descriptors for BlockreqPacket
  poly_packet_desc_add_field(BLOCKREQ_P_DESC , SRC_F_DESC , true );
  poly_packet_desc_add_field(BLOCKREQ_P_DESC , DST_F_DESC , true );
  poly_packet_desc_add_field(BLOCKREQ_P_DESC , BLOCKOFFSET_F_DESC , true );
  poly_packet_desc_add_field(BLOCKREQ_P_DESC , BLOCKSIZE_F_DESC , true );


  //Setting fields Descriptors for BlockrespPacket
  poly_packet_desc_add_field(BLOCKRESP_P_DESC , SRC_F_DESC , true );
  poly_packet_desc_add_field(BLOCKRESP_P_DESC , DST_F_DESC , true );
  poly_packet_desc_add_field(BLOCKRESP_P_DESC , BLOCKOFFSET_F_DESC , true );
  poly_packet_desc_add_field(BLOCKRESP_P_DESC , BLOCKSIZE_F_DESC , true );
  poly_packet_desc_add_field(BLOCKRESP_P_DESC , BLOCKDATA_F_DESC , true );


  //Register packet descriptors with parser 
  poly_parser_register_desc(SP_PARSER,ACK_P_DESC);
  poly_parser_register_desc(SP_PARSER,SETDATA_P_DESC);
  poly_parser_register_desc(SP_PARSER,GETDATA_P_DESC);
  poly_parser_register_desc(SP_PARSER,RESPDATA_P_DESC);
  poly_parser_register_desc(SP_PARSER,BLOCKREQ_P_DESC);
  poly_parser_register_desc(SP_PARSER,BLOCKRESP_P_DESC);

 //Start parser
  poly_parser_start(SP_PARSER);

}

ack_packet_t* new_ack()
{
  ack_packet_t* newStruct = (ack_packet_t*) malloc(sizeof(ack_packet_t));
  newStruct->mPacket = new_poly_packet(ACK_P_DESC);

  newStruct->mPacket->mBound = true;

  return newStruct;
}

setdata_packet_t* new_setdata()
{
  setdata_packet_t* newStruct = (setdata_packet_t*) malloc(sizeof(setdata_packet_t));
  newStruct->mPacket = new_poly_packet(SETDATA_P_DESC);

  poly_packet_gett_field(newStruct->mPacket, SRC_F_DESC)->mData = (uint8_t*) &newStruct->src;
  poly_packet_gett_field(newStruct->mPacket, DST_F_DESC)->mData = (uint8_t*) &newStruct->dst;
  poly_packet_gett_field(newStruct->mPacket, SENSORA_F_DESC)->mData = (uint8_t*) &newStruct->sensorA;
  poly_packet_gett_field(newStruct->mPacket, SENSORB_F_DESC)->mData = (uint8_t*) &newStruct->sensorB;
  poly_packet_gett_field(newStruct->mPacket, SENSORNAME_F_DESC)->mData = (uint8_t*) &newStruct->sensorName;
  newStruct->mPacket->mBound = true;

  return newStruct;
}

getdata_packet_t* new_getdata()
{
  getdata_packet_t* newStruct = (getdata_packet_t*) malloc(sizeof(getdata_packet_t));
  newStruct->mPacket = new_poly_packet(GETDATA_P_DESC);

  poly_packet_gett_field(newStruct->mPacket, SRC_F_DESC)->mData = (uint8_t*) &newStruct->src;
  poly_packet_gett_field(newStruct->mPacket, DST_F_DESC)->mData = (uint8_t*) &newStruct->dst;
  poly_packet_gett_field(newStruct->mPacket, SENSORA_F_DESC)->mData = (uint8_t*) &newStruct->sensorA;
  poly_packet_gett_field(newStruct->mPacket, SENSORB_F_DESC)->mData = (uint8_t*) &newStruct->sensorB;
  poly_packet_gett_field(newStruct->mPacket, SENSORNAME_F_DESC)->mData = (uint8_t*) &newStruct->sensorName;
  newStruct->mPacket->mBound = true;

  return newStruct;
}

respdata_packet_t* new_respdata()
{
  respdata_packet_t* newStruct = (respdata_packet_t*) malloc(sizeof(respdata_packet_t));
  newStruct->mPacket = new_poly_packet(RESPDATA_P_DESC);

  poly_packet_gett_field(newStruct->mPacket, SRC_F_DESC)->mData = (uint8_t*) &newStruct->src;
  poly_packet_gett_field(newStruct->mPacket, DST_F_DESC)->mData = (uint8_t*) &newStruct->dst;
  poly_packet_gett_field(newStruct->mPacket, SENSORA_F_DESC)->mData = (uint8_t*) &newStruct->sensorA;
  poly_packet_gett_field(newStruct->mPacket, SENSORB_F_DESC)->mData = (uint8_t*) &newStruct->sensorB;
  poly_packet_gett_field(newStruct->mPacket, SENSORNAME_F_DESC)->mData = (uint8_t*) &newStruct->sensorName;
  newStruct->mPacket->mBound = true;

  return newStruct;
}

blockreq_packet_t* new_blockreq()
{
  blockreq_packet_t* newStruct = (blockreq_packet_t*) malloc(sizeof(blockreq_packet_t));
  newStruct->mPacket = new_poly_packet(BLOCKREQ_P_DESC);

  poly_packet_gett_field(newStruct->mPacket, SRC_F_DESC)->mData = (uint8_t*) &newStruct->src;
  poly_packet_gett_field(newStruct->mPacket, DST_F_DESC)->mData = (uint8_t*) &newStruct->dst;
  poly_packet_gett_field(newStruct->mPacket, BLOCKOFFSET_F_DESC)->mData = (uint8_t*) &newStruct->blockOffset;
  poly_packet_gett_field(newStruct->mPacket, BLOCKSIZE_F_DESC)->mData = (uint8_t*) &newStruct->blockSize;
  newStruct->mPacket->mBound = true;

  return newStruct;
}

blockresp_packet_t* new_blockresp()
{
  blockresp_packet_t* newStruct = (blockresp_packet_t*) malloc(sizeof(blockresp_packet_t));
  newStruct->mPacket = new_poly_packet(BLOCKRESP_P_DESC);

  poly_packet_gett_field(newStruct->mPacket, SRC_F_DESC)->mData = (uint8_t*) &newStruct->src;
  poly_packet_gett_field(newStruct->mPacket, DST_F_DESC)->mData = (uint8_t*) &newStruct->dst;
  poly_packet_gett_field(newStruct->mPacket, BLOCKOFFSET_F_DESC)->mData = (uint8_t*) &newStruct->blockOffset;
  poly_packet_gett_field(newStruct->mPacket, BLOCKSIZE_F_DESC)->mData = (uint8_t*) &newStruct->blockSize;
  poly_packet_gett_field(newStruct->mPacket, BLOCKDATA_F_DESC)->mData = (uint8_t*) &newStruct->blockData;
  newStruct->mPacket->mBound = true;

  return newStruct;
}

